<!-- ================= SIDEBAR STYLE ================= -->
<style>

/* ===============================
   ADMIN MENU SECURITY
================================ */
#admin-menu-section.hidden-secure{
    display:none !important;
}

/* ===============================
   GLOBAL RESET
================================ */
html, body{
    margin:0;
    padding:0;
    width:100%;
    overflow-x:hidden;
}

/* ===============================
   SIDEBAR = FLOATING LAYER
   (‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏¥‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà layout)
================================ */
#sidebar{
    position:fixed;
    top:0;
    left:0;
    width:16rem;      /* w-64 */
    height:100vh;
    z-index:50;
}

/* ===============================
   DESKTOP ONLY
   ‡∏î‡∏±‡∏ô content ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà
================================ */
@media (min-width:1024px){

    body{
        padding-left:16rem; /* ‡πÄ‡∏ó‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á sidebar */
        transition:padding-left .25s ease;
    }

}

/* ===============================
   MOBILE FIX
   sidebar ‡πÄ‡∏õ‡πá‡∏ô overlay ‡∏à‡∏£‡∏¥‡∏á
================================ */
@media (max-width:1023px){

    body{
        padding-left:0 !important;
    }

    #sidebar{
        transform:translateX(-100%);
    }

}

</style>



<!-- ================= MOBILE TOPBAR ================= -->
<div class="lg:hidden flex items-center justify-between p-4 bg-white border-b sticky top-0 z-30">
    <button id="menu-toggle" class="text-2xl p-2 rounded-lg hover:bg-slate-100">‚ò∞</button>
    <h1 class="font-bold text-[#5c56f1]">Sale Support</h1>
    <div></div>
</div>

<!-- ================= OVERLAY ================= -->
<div id="sidebar-overlay"
class="fixed inset-0 bg-black/40 hidden z-40 lg:hidden"></div>

<!-- ================= SIDEBAR ================= -->
<div id="sidebar"
class="fixed top-0 left-0
       lg:sticky
       w-64
       -translate-x-full lg:translate-x-0
       transition-transform duration-300 ease-in-out
       flex flex-col
       bg-white h-screen
       border-r border-slate-200
       overflow-y-auto
       z-50">


<!-- HEADER -->
<div class="p-6 flex justify-between items-center">
    <h1 class="text-xl font-bold text-[#5c56f1] flex items-center gap-2">
        <span class="w-8 h-8 bg-[#5c56f1] rounded-lg flex items-center justify-center text-white text-xs">S</span>
        Sale Support
    </h1>
    <button id="menu-close" class="lg:hidden text-xl">‚úï</button>
</div>

<!-- MENU -->
<nav class="flex-1 px-4 space-y-1">

<p class="px-4 text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 mt-4">
Main Menu
</p>

<a href="dashboard.html" class="nav-link flex items-center gap-3 p-3.5 text-slate-600 hover:bg-indigo-50 hover:text-[#5c56f1] rounded-2xl transition">
üè† <span class="font-medium">Dashboard</span>
</a>

<a href="new-ticket.html" class="nav-link flex items-center gap-3 p-3.5 text-slate-600 hover:bg-indigo-50 hover:text-[#5c56f1] rounded-2xl transition">
‚ûï <span class="font-medium">‡∏™‡∏£‡πâ‡∏≤‡∏á Ticket</span>
</a>

<a href="my-ticket.html" class="nav-link flex items-center gap-3 p-3.5 text-slate-600 hover:bg-indigo-50 hover:text-[#5c56f1] rounded-2xl transition">
üìã <span class="font-medium">‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</span>
</a>

<a href="all-ticket.html" class="nav-link flex items-center gap-3 p-3.5 text-slate-600 hover:bg-indigo-50 hover:text-[#5c56f1] rounded-2xl transition">
üé´ <span class="font-medium">‡πÉ‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
</a>

<a href="profile.html" class="nav-link flex items-center gap-3 p-3.5 text-slate-600 hover:bg-indigo-50 hover:text-[#5c56f1] rounded-2xl transition">
üë§ <span class="font-medium">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</span>
</a>

<!-- ADMIN MENU -->
<div id="admin-menu-section" class="hidden-secure pt-6 border-t border-slate-100 mt-4">

<p class="px-4 text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">
Admin Control
</p>

<a href="admin-manage.html" class="nav-link flex items-center gap-3 p-3.5 rounded-2xl hover:bg-indigo-50">
üõ†Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô Admin
</a>

<a href="user-management.html" class="nav-link flex items-center gap-3 p-3.5 rounded-2xl hover:bg-indigo-50">
üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
</a>

<a href="topic-management.html" class="nav-link flex items-center gap-3 p-3.5 rounded-2xl hover:bg-indigo-50">
üìÇ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
</a>

<a href="team-management.html" class="nav-link flex items-center gap-3 p-3.5 rounded-2xl hover:bg-indigo-50">
üõ°Ô∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡∏°
</a>

<a href="report.html" class="nav-link flex items-center gap-3 p-3.5 rounded-2xl hover:bg-indigo-50">
üìä Report Dashboard
</a>

<a href="logs.html" class="nav-link flex items-center gap-3 p-3.5 rounded-2xl hover:bg-indigo-50">
üìú System Logs
</a>

</div>
</nav>

<!-- LOGOUT -->
<div class="p-4 border-t">
<button id="sidebar-logout-btn"
class="w-full flex items-center gap-3 p-4 text-red-500 hover:bg-red-50 rounded-2xl font-bold">
üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
</button>
</div>

</div>

<!-- ================= SCRIPT ================= -->
<script type="module">

import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc, addDoc, collection, serverTimestamp }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* FIREBASE CONFIG */
const firebaseConfig = {
apiKey:"AIzaSyAa2uSD_tjNqYE2eXnZcn75h_jAVscDG-c",
authDomain:"salesupportsystemapp.firebaseapp.com",
projectId:"salesupportsystemapp",
storageBucket:"salesupportsystemapp.firebasestorage.app",
messagingSenderId:"840890441207",
appId:"1:840890441207:web:f3a5076d46e963a90de2f2"
};

const app=getApps().length===0?initializeApp(firebaseConfig):getApps()[0];
const auth=getAuth(app);
const db=getFirestore(app);

let currentSessionUser=null;

/* ===== Activity Log ===== */
window.saveActivityLog=async(actionType,details,isError=false)=>{
const user=auth.currentUser;
if(!user)return;

try{
await addDoc(collection(db,"logs"),{
userId:user.uid,
userName:currentSessionUser?.name||user.email,
userEmail:user.email,
actionType,
details,
isError,
path:window.location.pathname.split("/").pop()||"index.html",
timestamp:serverTimestamp()
});
}catch(err){console.error(err);}
};

/* ===== Active Menu Highlight ===== */
const currentPage=window.location.pathname.split("/").pop();
document.querySelectorAll(".nav-link").forEach(link=>{
if(link.getAttribute("href")===currentPage){
link.classList.add("bg-indigo-50","text-[#5c56f1]","font-bold");
}
});

/* ===== Role Check ===== */
onAuthStateChanged(auth,async(user)=>{
const adminSection=document.getElementById("admin-menu-section");

if(user){
try{
const userRef=doc(db,"admin",user.uid);
const userSnap=await getDoc(userRef);

if(userSnap.exists()){
const userData=userSnap.data();
currentSessionUser=userData;

const role=(userData.role||"").toLowerCase().trim();

if(role==="admin"){
adminSection.classList.remove("hidden-secure");
}else{
adminSection.classList.add("hidden-secure");
}

window.saveActivityLog("PAGE_VIEW",`‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤ ${currentPage}`);
}
}catch(err){console.error(err);}
}else{
if(!location.href.includes("login.html")){
location.replace("login.html");
}
}
});

/* ===== Logout ===== */
document.getElementById("sidebar-logout-btn")
?.addEventListener("click",()=>{
if(confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")){
signOut(auth).then(()=>location.replace("login.html"));
}
});

/* ===== Hamburger ===== */
const sidebar=document.getElementById("sidebar");
const overlay=document.getElementById("sidebar-overlay");

function openSidebar(){
sidebar.classList.remove("-translate-x-full");
overlay.classList.remove("hidden");
}

function closeSidebar(){
sidebar.classList.add("-translate-x-full");
overlay.classList.add("hidden");
}

document.getElementById("menu-toggle")?.addEventListener("click",openSidebar);
document.getElementById("menu-close")?.addEventListener("click",closeSidebar);
overlay?.addEventListener("click",closeSidebar);

document.querySelectorAll(".nav-link").forEach(link=>{
link.addEventListener("click",()=>{
if(window.innerWidth<1024)closeSidebar();
});
});

</script>
